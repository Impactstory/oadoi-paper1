---
title: "OA paper"
author: "many"
output: github_document
---

*very much a work in progress*

```{r setup, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}
library(knitr)
opts_knit$set(progress=TRUE, tidy=TRUE, echo=TRUE)
# devtools::install_github("cboettig/knitcitations@v1")
library(knitcitations); cleanbib()
cite_options(citation_format = "pandoc", check.entries=FALSE)

library(bibtex)
library(magrittr)
library(ggplot2)
library(dplyr)
library(broom)
library(reshape)
library(scales)
library(corrplot)
library(forcats)
library(jsonlite)
library(tidyr)
```


Results outline
- How accurate is our OA detection
    (from Juan, modified to use hybrid analysis)
- How much OA is there?
- How is open access changing over time?
- How do OA patterns vary across publishers?
- Which repositories contribute most to OA availability?
- How do OA patterns vary by discipline?
- How much OA is there in most highly-accessed papers?
- Do different types of OA have different citation patterns?

Discussion
- limitations
    - some free-to-read where we don't get it (ResearchGate, personal web pages)
    - articles without DOIs
- future work
    - more citation, altmetrics studies
- expounding on what this means for the future of OA



```{r get_data, echo=FALSE, cache=TRUE, results='hide'}
# setwd("~/Dropbox/ti/oadoi-paper")

#### uncomment this on first run of the day
articles_raw <- read.csv("export_study_hybrid_20170504.csv")
articles_all = articles_raw

# modify the colors to handle hybrid
articles_all = articles_all %>%
  mutate(is_open_license=(grepl("cc", license) | oa_color=="gold"))

# there is an artifact in the data caused by this "publisher." remove.
articles_all = articles_all %>% filter(publisher != "CrossRef Test Account")

articles_all$oa = "closed"
articles_all$oa[articles_all$oa_color=="green"] = "green_only"
articles_all$oa[articles_all$oa_color=="gold"] = "gold_doaj"
articles_all$oa[articles_all$oa_color=="blue" & articles_all$is_open_license] = "gold_not_doaj"
articles_all$oa[articles_all$oa_color=="blue" & !articles_all$is_open_license] = "free"

# sort the factor for easier plotting
articles_all = mutate(articles_all, oa=fct_infreq(oa))

# handy for color-coding later
oa_color_map = scale_fill_manual(values=c("#777777", "#2196F3", "#4CAF50", "#FFC107", "#FFEB3B"))


```













# How much OA is there?
====================


```{r}
articles_all %>% count(oa) %>% mutate(proportion=n/sum(n))
articles_all %>% ggplot(aes(x="", fill=oa)) + geom_bar() + oa_color_map
```
* insert definitions of our colors here *

So, about 23% of the DOI-assigned literature is available to read. But we know that in recent years OA has been gaining steam, so let's let's look more closely at OA over time.





# How is open access changing over time?
===================

How complete is the publication year data from Crossref?

```{r}
articles_all %>% group_by(year <= 2017 & year >= 1500) %>% summarise(n())



```

It seems the year data is pretty good, with less than 0.1% missing or obviously wrong years. We don't really want to look at data since 1500, so let's see what's a reasonable window to examine. We'll try 1990 because it's comfortably before the "modern era" of open access.

```{r}

# subset by time
articles_all = articles_all %>% mutate(is_modern = year >= 1990 & year <= 2017)
articles_all %>% filter(is_modern) %>%
    ggplot(aes(x=year)) + geom_bar(width=1) 

```

Unsurprisingly, we do not yet have enough data from 2017 to plot. More surprisingly, 2016 seems to be missing some data as well. Publishers can be slow to deposit information with Crossref, and this is likely the cause. So, we'll remove 2017 and 2016 from our timeseries subset.

```{r}
articles_all = articles_all %>% mutate(is_modern = year >= 1990 & year <= 2015)
articles_all %>% count(is_modern) %>% mutate(proportion = n / sum(n))

```

This subset will still cover nearly two thirds of all DOIs ever, while letting us zoom in on the years of interest.

We'll start with plotting absolute numbers of OA articles:
```{r}
articles_all %>% filter(is_modern) %>%
    ggplot(aes(x=year, fill=oa)) + geom_bar(width=1) + oa_color_map
```

We can see the absolute number of free-to-read articles of all kinds is growing significantly. However, we're particularly interested in the by-year *proportion* of the literature that is free to read.

```{r}
# see http://stackoverflow.com/questions/24576515/relative-frequencies-proportions-with-dplyr
oa_freq_by_year = articles_all %>% filter(is_modern) %>% count(year, oa) %>%  
  mutate(perc = n / sum(n)) %>%  
  ungroup()  

oa_freq_by_year %>% ggplot(aes(x=year, y=perc, fill=oa)) + geom_area() + oa_color_map
```


The proportion of OA is growing, too--not just the absolute amounts.


# publishers
# ========================

Let's look at publishers. We'll subset the years even further, so we can look at the more up-to-date picture that may include OA publishers.

```{r}

# sort the publisher factor by frequency...helps in plotting.
articles_all$publisher = fct_infreq(articles_all$publisher)

publishers = articles_all %>% 
    filter(is_modern, year >= 2009) %>%
    count(publisher, oa) %>%
    arrange(desc(n)) %>%
    ungroup()

# the top 25 publishers publish 80% of articles.
# top 100 publshers publish 87% of articles.
sum(publishers$n[0:20]) /sum(publishers$n)
```



```{r}
publishers %>% slice(1:25) %>% ggplot(aes(x=publisher, y=n)) + geom_bar(stat="identity") + coord_flip()
```

Looking at top twenty publishers, we get about half of articles. Looks like there is a very long tail of smaller publishers. 

coming soon: oa by publisher.


# Which repositories contribute most to OA availability?
------------


## Growth in literature over time with any green
```{r}
gray_green_color_map = scale_fill_manual(values=c("#777777", "#008000", "#FFD700"))

articles_all %>% filter(is_modern) %>% ggplot(aes(x=year, fill=found_green)) + geom_bar(width=1) + gray_green_color_map
```
## Proportion of all articles that have been deposited in a repository

```{r}
found_green_freq_by_year = articles_all %>% filter(is_modern) %>% count(year, found_green) %>% 
  mutate(perc = n / sum(n)) %>% 
  ungroup()  
found_green_freq_by_year %>% ggplot(aes(x=year, y=perc, fill=found_green)) + geom_area() + gray_green_color_map
```

## Proportion of all articles that can only be accessed through a repository

```{r}
only_green_freq_by_year = articles_all %>% filter(is_modern) %>% mutate(is_green=oa=="green_only") %>% count(year, is_green) %>% mutate(perc = n / sum(n)) %>% ungroup()  

only_green_freq_by_year %>% ggplot(aes(x=year, y=perc, fill=is_green)) + geom_area() + gray_green_color_map
```

```{r}
articles_all %>% filter(is_modern) %>% ggplot(aes(x=year, fill=evidence)) + geom_bar(width=1)

articles_all %>% filter(is_modern) %>% mutate(is_green=oa=="green_only")  %>% filter(is_green) %>% filter(grepl('pmcid', evidence)) %>% ggplot(aes(x=year, fill=is_green)) + geom_bar(width=1)

# citeseerx
articles_all %>% filter(is_modern) %>% mutate(is_green=oa=="green_only")  %>% filter(is_green) %>% mutate(base_collection_string=as.character(green_base_collections)) %>% filter(grepl('citeseerx', base_collection_string)) %>% ggplot(aes(x=year, fill=is_green)) + geom_bar(width=1)

# arxiv
articles_all %>% filter(is_modern) %>% mutate(is_green=oa=="green_only")  %>% filter(is_green) %>% mutate(base_collection_string=as.character(green_base_collections)) %>% filter(grepl('arxiv', base_collection_string)) %>% ggplot(aes(x=year, fill=is_green)) + geom_bar(width=1)

# pubmed
articles_all %>% filter(is_modern) %>% mutate(is_green=oa=="green_only")  %>% filter(is_green) %>% mutate(base_collection_string=as.character(green_base_collections)) %>% filter(grepl('pubmed', base_collection_string)) %>% ggplot(aes(x=year, fill=is_green)) + geom_bar(width=1)

# not citeseerx or arxiv or pubmed
articles_all %>% filter(is_modern) %>% mutate(is_green=oa=="green_only")  %>% filter(is_green) %>% mutate(base_collection_string=as.character(green_base_collections)) %>% filter(!grepl('citeseerx', base_collection_string), !grepl('arxiv', base_collection_string), !grepl('pubmed', base_collection_string), !grepl('pmcid', evidence)) %>% ggplot(aes(x=year, fill=is_green)) + geom_bar(width=1)


```



# By license
------------
```{r}
articles_all %>% filter(is_modern) %>% filter(grepl('cc', license)) %>% ggplot(aes(x=year, fill=license)) + geom_bar(width=1, position="fill") 

```

